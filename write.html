<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Write a Story - Storyline</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.quilljs.com/1.3.7/quill.snow.css" rel="stylesheet" />
  <style>
    .story-img-preview {
      max-height: 200px;
      object-fit: cover;
      border-radius: 5px;
    }

    .form-section {
      background-color: #f8f9fa;
      padding: 2rem;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    .preview-card {
      max-width: 100%;
    }

    .chapter-container {
      border: 1px solid #ddd;
      border-radius: 5px;
      padding: 10px;
      margin-bottom: 15px;
      background-color: #fff;
    }

    .remove-chapter {
      cursor: pointer;
    }
  </style>
</head>

<body>

  <!-- NAVBAR -->
  <nav class="navbar navbar-expand-lg navbar-dark" style="background-color:#006d77;">
    <div class="container">
      <a class="navbar-brand fw-bold" href="index.html">
        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="currentColor" class="bi bi-book me-2"
          viewBox="0 0 16 16">
          <path
            d="M1 2.828c.885-.37 2.154-.769 3.388-.893 1.33-.134 2.458.063 3.112.752v9.746c-.935-.53-2.12-.603-3.213-.493-1.18.12-2.37.461-3.287.811V2.828zm7.5-.141c.654-.689 1.782-.886 3.112-.752 1.234.124 2.503.523 3.388.893v9.923c-.918-.35-2.107-.692-3.287-.81-1.094-.111-2.278-.039-3.213.492V2.687zM8 1.783C7.015.936 5.587.81 4.287.94c-1.514.153-3.042.672-3.994 1.105A.5.5 0 0 0 0 2.5v11a.5.5 0 0 0 .707.455c.882-.4 2.303-.881 3.68-1.02 1.409-.142 2.59.087 3.223.877a.5.5 0 0 0 .78 0c.633-.79 1.814-1.019 3.222-.877 1.378.139 2.8.62 3.681 1.02A.5.5 0 0 0 16 13.5v-11a.5.5 0 0 0-.293-.455c-.952-.433-2.48-.952-3.994-1.105C10.413.809 8.985.936 8 1.783z" />
        </svg>
        Storyline
      </a>

      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent"
        aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarContent">
        <ul class="navbar-nav ms-auto align-items-center">
          <li class="nav-item"><a class="nav-link active" href="dashboard.html">Dashboard</a></li>
          <li class="nav-item"><a class="nav-link" href="browse.html">Browse</a></li>
          <li class="nav-item"><a class="nav-link" href="write.html">Write</a></li>
        </ul>

        <!-- Profile Image on the right -->
        <ul class="navbar-nav ms-3">
          <li class="nav-item dropdown">
            <a class="nav-link p-0" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              <div class="rounded-circle overflow-hidden" style="width: 38px; height: 38px; cursor: pointer;">
                <img src="images/download (1).jpeg" alt="Profile" class="w-100 h-100">
              </div>
            </a>
            <ul class="dropdown-menu dropdown-menu-end">
              <li><a class="dropdown-item" href="profile.html">My Profile</a></li>
              <li><a class="dropdown-item" href="mystories.html">My Stories</a></li>
              <li><a class="dropdown-item" href="#">Settings</a></li>
              <li>
                <hr class="dropdown-divider">
              </li>
              <li><a class="dropdown-item" href="#">Logout</a></li>
            </ul>
          </li>
        </ul>

      </div>
    </div>
  </nav>


  <!-- Page Content -->
  <div class="container mt-5 mb-5">

    <h2 class="mb-4">üìù Write a New Story</h2>

    <div class="row">
      <!-- Form Section -->
      <div class="col-lg-6">
        <div class="form-section">
          <form id="storyForm">
            <div class="mb-3">
              <label for="storyTitle" class="form-label">Story Title</label>
              <input type="text" class="form-control" id="storyTitle" placeholder="Enter your story title" required>
            </div>

            <div class="mb-3">
              <label for="storyAuthor" class="form-label">Author</label>
              <input type="text" class="form-control" id="storyAuthor" placeholder="Your name" required>
            </div>

            <div class="mb-3">
              <label for="storyGenre" class="form-label">Genre</label>
              <select class="form-select" id="storyGenre" required>
                <option selected disabled>Select genre</option>
                <option>Fantasy</option>
                <option>Thriller</option>
                <option>Horror</option>
                <option>Mystery</option>
                <option>Action</option>
                <option>Sci-Fi</option>
              </select>
            </div>

            <div class="mb-3">
              <label for="storyImage" class="form-label">Upload Cover Image</label>
              <input class="form-control" type="file" id="storyImage" accept="image/*">
            </div>

            <hr>
            <h5>Chapters</h5>
            <div id="chaptersContainer"></div>
            <button type="button" class="btn btn-success mb-3" id="addChapterBtn">+ Add Chapter</button>

            <div class="d-flex justify-content-between">
              <button type="reset" class="btn btn-secondary">Clear</button>
              <button type="submit" class="btn btn-primary">Submit Story</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Preview Section -->
      <div class="col-lg-6 mt-4 mt-lg-0">
        <h5>Preview</h5>
        <div class="card preview-card h-100">
          <img src="https://via.placeholder.com/600x300?text=Story+Cover" class="card-img-top story-img-preview"
            id="previewImage" alt="Cover Preview">
          <div class="card-body">
            <h5 class="card-title" id="previewTitle">Story Title</h5>
            <p class="card-text text-muted" id="previewAuthor">by Author</p>
            <span class="badge bg-primary" id="previewGenre">Genre</span>
            <div id="previewChapters" class="mt-2">
              <p class="text-muted">Chapters will appear here...</p>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>

  <footer class="text-center mt-5 p-3 bg-light">
    <p>&copy; 2025 Storyline. All rights reserved.</p>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.quilljs.com/1.3.7/quill.min.js"></script>
  <script>
    const storyTitle = document.getElementById('storyTitle');
    const storyAuthor = document.getElementById('storyAuthor');
    const storyGenre = document.getElementById('storyGenre');
    const storyImage = document.getElementById('storyImage');
    const chaptersContainer = document.getElementById('chaptersContainer');
    const previewChapters = document.getElementById('previewChapters');

    let chapterCount = 0;
    const quillEditors = [];

    // Load story for editing
    const editIndex = localStorage.getItem('editStoryIndex');
    if (editIndex !== null) {
      const userStories = JSON.parse(localStorage.getItem('userStories')) || [];
      const story = userStories[editIndex];

      storyTitle.value = story.title;
      storyAuthor.value = story.author;
      storyGenre.value = story.genre;
      document.getElementById('previewTitle').textContent = story.title;
      document.getElementById('previewAuthor').textContent = `by ${story.author}`;
      const badge = document.getElementById('previewGenre');
      badge.textContent = story.genre;
      badge.className = `badge ${getGenreColor(story.genre)}`;

      if (story.cover) {
        document.getElementById('previewImage').src = story.cover;
      }

      // Load chapters
      story.chapters.forEach(chapter => {
        chapterCount++;
        const chapterDiv = document.createElement('div');
        chapterDiv.classList.add('chapter-container');
        chapterDiv.innerHTML = `
      <div class="d-flex justify-content-between align-items-center mb-2">
        <h6>Chapter ${chapterCount}</h6>
        <span class="text-danger remove-chapter">Remove</span>
      </div>
      <input type="text" class="form-control mb-2 chapter-title" placeholder="Chapter Title" required value="${chapter.title}">
      <div id="editor-${chapterCount}" style="height: 150px;"></div>
    `;
        chaptersContainer.appendChild(chapterDiv);

        const quill = new Quill(`#editor-${chapterCount}`, {
          theme: 'snow',
          placeholder: 'Write chapter content here...',
          modules: { toolbar: [['bold', 'italic'], [{ list: 'ordered' }, { list: 'bullet' }]] }
        });
        quill.root.innerHTML = chapter.content; // load chapter content
        quillEditors.push(quill);

        // Remove chapter
        chapterDiv.querySelector('.remove-chapter').addEventListener('click', () => {
          chaptersContainer.removeChild(chapterDiv);
          quillEditors.splice(chapterCount - 1, 1);
          updatePreview();
        });

        quill.on('text-change', updatePreview);
      });

      localStorage.removeItem('editStoryIndex'); // clear edit flag
    }

    // Helper to get genre badge color
    function getGenreColor(genre) {
      const colors = {
        'Fantasy': 'bg-primary',
        'Thriller': 'bg-success',
        'Horror': 'bg-warning',
        'Mystery': 'bg-info',
        'Action': 'bg-danger',
        'Sci-Fi': 'bg-dark'
      };
      return colors[genre] || 'bg-primary';
    }

    // Add Chapter Button
    document.getElementById('addChapterBtn').addEventListener('click', () => {
      chapterCount++;
      const chapterDiv = document.createElement('div');
      chapterDiv.classList.add('chapter-container');
      chapterDiv.innerHTML = `
    <div class="d-flex justify-content-between align-items-center mb-2">
      <h6>Chapter ${chapterCount}</h6>
      <span class="text-danger remove-chapter">Remove</span>
    </div>
    <input type="text" class="form-control mb-2 chapter-title" placeholder="Chapter Title" required>
    <div id="editor-${chapterCount}" style="height: 150px;"></div>
  `;
      chaptersContainer.appendChild(chapterDiv);

      const quill = new Quill(`#editor-${chapterCount}`, {
        theme: 'snow',
        placeholder: 'Write chapter content here...',
        modules: { toolbar: [['bold', 'italic'], [{ list: 'ordered' }, { list: 'bullet' }]] }
      });
      quillEditors.push(quill);

      // Remove chapter
      chapterDiv.querySelector('.remove-chapter').addEventListener('click', () => {
        chaptersContainer.removeChild(chapterDiv);
        quillEditors.splice(chapterCount - 1, 1);
        updatePreview();
      });

      quill.on('text-change', updatePreview);
    });

    // Preview updates
    storyTitle.addEventListener('input', updatePreview);
    storyAuthor.addEventListener('input', updatePreview);
    storyGenre.addEventListener('change', updatePreview);
    storyImage.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (file) {
        document.getElementById('previewImage').src = URL.createObjectURL(file);
      } else {
        document.getElementById('previewImage').src = 'https://via.placeholder.com/600x300?text=Story+Cover';
      }
    });

    function updatePreview() {
      document.getElementById('previewTitle').textContent = storyTitle.value || 'Story Title';
      document.getElementById('previewAuthor').textContent = storyAuthor.value ? `by ${storyAuthor.value}` : 'by Author';

      const genre = storyGenre.value;
      const badge = document.getElementById('previewGenre');
      badge.textContent = genre || 'Genre';
      badge.className = `badge ${getGenreColor(genre)}`;

      previewChapters.innerHTML = '';
      document.querySelectorAll('.chapter-container').forEach((chapter, idx) => {
        const title = chapter.querySelector('.chapter-title').value || `Chapter ${idx + 1}`;
        const content = quillEditors[idx]?.root.innerHTML || '';
        const div = document.createElement('div');
        div.innerHTML = `<h6>${title}</h6><p>${content}</p><hr>`;
        previewChapters.appendChild(div);
      });

      if (previewChapters.innerHTML === '') {
        previewChapters.innerHTML = '<p class="text-muted">Chapters will appear here...</p>';
      }
    }

    // Form submission (new or edited)
    document.getElementById('storyForm').addEventListener('submit', (e) => {
      e.preventDefault();
      const stories = JSON.parse(localStorage.getItem('userStories')) || [];

      const storyData = {
        title: storyTitle.value,
        author: storyAuthor.value,
        genre: storyGenre.value,
        cover: document.getElementById('previewImage').src,
        chapters: quillEditors.map((q, i) => ({
          title: document.querySelectorAll('.chapter-title')[i].value,
          content: q.root.innerHTML
        }))
      };

      // Check if editing existing story
      if (editIndex !== null) {
        stories[editIndex] = storyData;
      } else {
        stories.push(storyData);
      }

      localStorage.setItem('userStories', JSON.stringify(stories));
      alert('Story saved successfully!');
      window.location.href = 'mystories.html';
    });
  </script>

</body>

</html>