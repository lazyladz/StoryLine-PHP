<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Storyline - Story Details</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .story-cover { max-width: 350px; object-fit: cover; }
    .badge-genre { margin: 2px 2px 2px 0; }
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark" style="background-color:#006d77;">
  <div class="container">
    <a class="navbar-brand fw-bold" href="index.html">
      <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="currentColor" class="bi bi-book me-2" viewBox="0 0 16 16">
        <path d="M1 2.828c.885-.37 2.154-.769 3.388-.893 1.33-.134 2.458.063 3.112.752v9.746c-.935-.53-2.12-.603-3.213-.493-1.18.12-2.37.461-3.287.811V2.828zm7.5-.141c.654-.689 1.782-.886 3.112-.752 1.234.124 2.503.523 3.388.893v9.923c-.918-.35-2.107-.692-3.287-.81-1.094-.111-2.278-.039-3.213.492V2.687zM8 1.783C7.015.936 5.587.81 4.287.94c-1.514.153-3.042.672-3.994 1.105A.5.5 0 0 0 0 2.5v11a.5.5 0 0 0 .707.455c.882-.4 2.303-.881 3.68-1.02 1.409-.142 2.59.087 3.223.877a.5.5 0 0 0 .78 0c.633-.79 1.814-1.019 3.222-.877 1.378.139 2.8.62 3.681 1.02A.5.5 0 0 0 16 13.5v-11a.5.5 0 0 0-.293-.455c-.952-.433-2.48-.952-3.994-1.105C10.413.809 8.985.936 8 1.783z"/>
      </svg>
      Storyline
    </a>

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent" 
            aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarContent">
      <ul class="navbar-nav ms-auto align-items-center">
        <li class="nav-item"><a class="nav-link active" href="dashboard.html">Dashboard</a></li>
        <li class="nav-item"><a class="nav-link" href="browse.html">Browse</a></li>
        <li class="nav-item"><a class="nav-link" href="write.html">Write</a></li>
      </ul>

      <!-- Profile Image on the right -->
      <ul class="navbar-nav ms-3">
        <li class="nav-item dropdown">
          <a class="nav-link p-0" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            <div class="rounded-circle overflow-hidden" style="width: 38px; height: 38px; cursor: pointer;">
              <img src="images/download (1).jpeg" alt="Profile" class="w-100 h-100">
            </div>
          </a>
          <ul class="dropdown-menu dropdown-menu-end">
    <li><a class="dropdown-item" href="profile.html">My Profile</a></li>
    <li><a class="dropdown-item" href="mystories.html">My Stories</a></li>
    <li><a class="dropdown-item" href="#">Settings</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="#">Logout</a></li>
  </ul>
        </li>
      </ul>

    </div>
  </div>
</nav>

  <!-- Story Content -->
  <div class="container mt-4">
    <a href="mystories.html" class="btn btn-outline-primary mb-3">&larr; Back to My Stories</a>
    <div class="d-flex flex-column flex-md-row gap-4">
      <img id="storyCover" src="" alt="Story Cover" class="img-fluid rounded shadow story-cover">
      <div class="flex-grow-1">
        <h2 id="storyTitle" class="fw-bold"></h2>
        <p class="lead" id="storyDescription"></p>
        <div id="storyGenres" class="mb-3"></div>

        <h4>Chapters</h4>
        <ul class="list-group mb-4" id="storyChapters"></ul>

        <h4>Comments</h4>
        <ul class="list-group" id="storyComments">
          <li class="list-group-item">No comments yet.</li>
        </ul>
      </div>
    </div>
  </div>
  <div id="chapterContent" class="mt-4 p-3 border rounded bg-light d-none">
  <h5 id="chapterTitle"></h5>
  <p id="chapterText"></p>
  <div class="d-flex justify-content-between mt-3">
    <button id="prevChapter" class="btn btn-sm btn-secondary">Previous</button>
    <button id="nextChapter" class="btn btn-sm btn-secondary">Next</button>
  </div>
</div>


  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>
  

<script>
  // Get story index from localStorage
  const storyIndex = localStorage.getItem('viewStoryIndex');
  if (!storyIndex) {
    alert('No story selected!');
    window.location.href = 'mystories.html';
  }

  const stories = JSON.parse(localStorage.getItem('userStories')) || [];
  const story = stories[storyIndex];

  if (!story) {
    alert('Story not found!');
    window.location.href = 'mystories.html';
  }

  // Populate story details
  document.getElementById('storyCover').src = story.cover || 'https://via.placeholder.com/400x200?text=No+Cover';
  document.getElementById('storyTitle').textContent = story.title;
  document.getElementById('storyDescription').textContent = story.description || 'No description available.';

  const genresContainer = document.getElementById('storyGenres');
  genresContainer.innerHTML = '';
  if (story.genre) {
    const genres = Array.isArray(story.genre) ? story.genre : [story.genre];
    genres.forEach(g => {
      const span = document.createElement('span');
      span.className = 'badge bg-secondary badge-genre me-1 mb-1';
      span.textContent = g;
      genresContainer.appendChild(span);
    });
  }

  // Populate chapters
  const chaptersContainer = document.getElementById('storyChapters');
  chaptersContainer.innerHTML = '';
  if (story.chapters && story.chapters.length > 0) {
    story.chapters.forEach((ch, i) => {
      const li = document.createElement('li');
      li.className = 'list-group-item d-flex justify-content-between align-items-center';
      li.innerHTML = `
        ${ch.title} â€“ ${ch.content.substring(0, 50)}...
        <a href="#" class="btn btn-sm btn-outline-primary" onclick="showChapterContent(${i})">Read</a>
      `;
      chaptersContainer.appendChild(li);
    });
  } else {
    chaptersContainer.innerHTML = '<li class="list-group-item">No chapters yet.</li>';
  }

  // Chapter display
  const chapterContentDiv = document.getElementById('chapterContent');
  const chapterTitle = document.getElementById('chapterTitle');
  const chapterText = document.getElementById('chapterText');
  const prevBtn = document.getElementById('prevChapter');
  const nextBtn = document.getElementById('nextChapter');

  let currentChapterIndex = 0;

  window.showChapterContent = function(index) {
    currentChapterIndex = index;
    displayChapter(currentChapterIndex);
    chapterContentDiv.classList.remove('d-none');
    chapterContentDiv.scrollIntoView({ behavior: 'smooth' });
  }

  function displayChapter(index) {
  const chapter = story.chapters[index];
  chapterTitle.textContent = chapter.title;

  // Use innerHTML directly if content already has HTML tags
  chapterText.innerHTML = chapter.content; 

  // Enable/disable navigation buttons
  prevBtn.disabled = (index === 0);
  nextBtn.disabled = (index === story.chapters.length - 1);
}


  prevBtn.addEventListener('click', () => {
    if (currentChapterIndex > 0) {
      currentChapterIndex--;
      displayChapter(currentChapterIndex);
    }
  });

  nextBtn.addEventListener('click', () => {
    if (currentChapterIndex < story.chapters.length - 1) {
      currentChapterIndex++;
      displayChapter(currentChapterIndex);
    }
  });

  // Populate comments
  const commentsContainer = document.getElementById('storyComments');
  commentsContainer.innerHTML = '';
  if (story.comments && story.comments.length > 0) {
    story.comments.forEach(c => {
      const li = document.createElement('li');
      li.className = 'list-group-item';
      li.textContent = c;
      commentsContainer.appendChild(li);
    });
  } else {
    commentsContainer.innerHTML = '<li class="list-group-item">No comments yet.</li>';
  }
</script>

</body>
</html>
