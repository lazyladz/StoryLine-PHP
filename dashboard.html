<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dashboard - Storyline</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link rel="stylesheet" href="css/styles.css" />
</head>

<body>

  <nav class="navbar navbar-expand-lg">
    <div class="container">
      <a class="navbar-brand" href="index.html">
        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="currentColor" class="bi bi-book me-2"
          viewBox="0 0 16 16">
          <path
            d="M1 2.828c.885-.37 2.154-.769 3.388-.893 1.33-.134 2.458.063 3.112.752v9.746c-.935-.53-2.12-.603-3.213-.493-1.18.12-2.37.461-3.287.811V2.828zm7.5-.141c.654-.689 1.782-.886 3.112-.752 1.234.124 2.503.523 3.388.893v9.923c-.918-.35-2.107-.692-3.287-.81-1.094-.111-2.278-.039-3.213.492V2.687zM8 1.783C7.015.936 5.587.81 4.287.94c-1.514.153-3.042.672-3.994 1.105A.5.5 0 0 0 0 2.5v11a.5.5 0 0 0 .707.455c.882-.4 2.303-.881 3.68-1.02 1.409-.142 2.59.087 3.223.877a.5.5 0 0 0 .78 0c.633-.79 1.814-1.019 3.222-.877 1.378.139 2.8.62 3.681 1.02A.5.5 0 0 0 16 13.5v-11a.5.5 0 0 0-.293-.455c-.952-.433-2.48-.952-3.994-1.105C10.413.809 8.985.936 8 1.783z" />
        </svg>
        Storyline
      </a>

      <!-- Toggler button for mobile -->
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent"
        aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <!-- Desktop Search Form -->
      <div class="d-none d-lg-flex mx-auto search-container" style="max-width: 400px; flex-grow:1;">
        <div class="input-group">
          <input id="searchInput" class="form-control" type="search" placeholder="Search stories..." aria-label="Search" autocomplete="off" />
          <button class="btn btn-main" type="button">Search</button>
        </div>
        
        <div class="dropdown-menu search-dropdown p-3 mt-1" aria-labelledby="searchInput">
          <h6 class="dropdown-header">Filter by Genre</h6>
          <div class="genre-filters">
            <span class="genre-tag" data-genre="Fantasy">Fantasy</span>
            <span class="genre-tag" data-genre="Thriller">Thriller</span>
            <span class="genre-tag" data-genre="Horror">Horror</span>
            <span class="genre-tag" data-genre="Mystery">Mystery</span>
            <span class="genre-tag" data-genre="Action">Action</span>
            <span class="genre-tag" data-genre="Sci-Fi">Sci-Fi</span>
            <span class="genre-tag" data-genre="Romance">Romance</span>
            <span class="genre-tag" data-genre="Comedy">Comedy</span>
          </div>
        </div>
      </div>

      <!-- Collapsible content -->
      <div class="collapse navbar-collapse" id="navbarContent">
        <!-- Mobile Search Form (hidden on larger screens) -->
        <div class="d-lg-none mt-3 mb-2 search-container">
          <div class="input-group">
            <input type="search" class="form-control" placeholder="Search stories..." aria-label="Search" />
            <button class="btn btn-main" type="button">Search</button>
          </div>

          <div class="mt-2">
            <h6>Filter by Genre</h6>
            <div class="genre-filters">
              <span class="genre-tag" data-genre="Fantasy">Fantasy</span>
              <span class="genre-tag" data-genre="Thriller">Thriller</span>
              <span class="genre-tag" data-genre="Horror">Horror</span>
              <span class="genre-tag" data-genre="Mystery">Mystery</span>
              <span class="genre-tag" data-genre="Action">Action</span>
              <span class="genre-tag" data-genre="Sci-Fi">Sci-Fi</span>
            </div>
          </div>
        </div>

        <ul class="navbar-nav ms-auto align-items-center">
          <li class="nav-item"><a class="nav-link" href="write.html"><i class="fas fa-pen me-1"></i>Write</a></li>
          <li class="nav-item"><a class="nav-link" href="browse.html"><i class="fas fa-compass me-1"></i>Browse</a></li>
          
          <!-- User dropdown -->
          <li class="nav-item dropdown ms-2">
            <a class="nav-link p-0" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              <div class="rounded-circle overflow-hidden d-flex align-items-center justify-content-center" style="width: 40px; height: 40px; background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); color: white; font-weight: bold;">
                <span id="userInitial">U</span>
              </div>
            </a>
            <ul class="dropdown-menu dropdown-menu-end">
              <li><a class="dropdown-item" href="profile.html"><i class="fas fa-user me-2"></i>My Profile</a></li>
              <li><a class="dropdown-item" href="mystories.html"><i class="fas fa-book me-2"></i>My Stories</a></li>
              <li><a class="dropdown-item" href="#"><i class="fas fa-cog me-2"></i>Settings</a></li>
              <li><hr class="dropdown-divider"></li>
              <li><a class="dropdown-item" href="#" id="logoutBtn"><i class="fas fa-sign-out-alt me-2"></i>Logout</a></li>
            </ul>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  

  <!-- Page Content -->
  <div class="container">

    <!-- Quick Actions -->
    <div class="quick-actions">
      <h4 class="section-title"><i class="fas fa-bolt"></i>Quick Actions</h4>
  

    <!-- My Stories -->
    <h4 class="section-title"><i class="fas fa-bookmark"></i>My Stories</h4>
    <div class="row g-3" id="dashboardMyStories">
      <!-- JS will inject user stories here -->
    </div>
    <div id="noDashboardStories" class="empty-state d-none">
      <i class="fas fa-book-open"></i>
      <h4>No stories yet</h4>
      <p>You haven't uploaded any stories. Start your writing journey today!</p>
      <a href="write.html" class="btn btn-main">Write Your First Story</a>
    </div>

    <!-- Continue Reading -->
    <h4 class="section-title"><i class="fas fa-play-circle"></i>Continue Reading</h4>
    <div class="row g-3">
      <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6">
        <a href="stories.html" class="text-decoration-none text-reset">
          <div class="card h-100 story-card">
            <img src="https://images.unsplash.com/photo-1544716278-ca5e3f4abd8c?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" class="card-img-top story-img" alt="Whispers of Dawn">
            <div class="card-body">
              <h6 class="card-title">Whispers of Dawn</h6>
              <small class="text-muted">by Ana Cruz</small>
              <div class="mt-2">
                <span class="badge bg-primary">Fantasy</span>
              </div>
              <div class="story-stats">
                <span class="reads">Ch. 3 of 12</span>
                <span class="rating">4.8 ★</span>
              </div>
              <div class="progress mt-2" style="height: 4px;">
                <div class="progress-bar" style="width: 25%"></div>
              </div>
            </div>
          </div>
        </a>
      </div>

      <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6">
        <div class="card h-100 story-card">
          <img src="https://images.unsplash.com/photo-1512820790803-83ca734da794?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" class="card-img-top story-img" alt="Echoes in the Dark">
          <div class="card-body">
            <h6 class="card-title">Echoes in the Dark</h6>
            <small class="text-muted">by Leo Martinez</small>
            <div class="mt-2">
              <span class="badge bg-success">Thriller</span>
            </div>
            <div class="story-stats">
              <span class="reads">Ch. 7 of 10</span>
              <span class="rating">4.5 ★</span>
            </div>
            <div class="progress mt-2" style="height: 4px;">
              <div class="progress-bar" style="width: 70%"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6">
        <div class="card h-100 story-card">
          <img src="https://images.unsplash.com/photo-1506905925346-21bda4d32df4?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" class="card-img-top story-img" alt="Shadows Beneath">
          <div class="card-body">
            <h6 class="card-title">Shadows Beneath</h6>
            <small class="text-muted">by Sofia Lim</small>
            <div class="mt-2">
              <span class="badge bg-warning text-dark">Horror</span>
            </div>
            <div class="story-stats">
              <span class="reads">Ch. 1 of 8</span>
              <span class="rating">4.2 ★</span>
            </div>
            <div class="progress mt-2" style="height: 4px;">
              <div class="progress-bar" style="width: 12%"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6">
        <div class="card h-100 story-card">
          <img src="https://images.unsplash.com/photo-1532012197267-da84d127e765?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" class="card-img-top story-img" alt="The Last Melody">
          <div class="card-body">
            <h6 class="card-title">The Last Melody</h6>
            <small class="text-muted">by Maria Gomez</small>
            <div class="mt-2">
              <span class="badge bg-info text-dark">Mystery</span>
            </div>
            <div class="story-stats">
              <span class="reads">Ch. 5 of 7</span>
              <span class="rating">4.9 ★</span>
            </div>
            <div class="progress mt-2" style="height: 4px;">
              <div class="progress-bar" style="width: 71%"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6">
        <div class="card h-100 story-card">
          <img src="https://images.unsplash.com/photo-1534447677768-be436bb09401?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" class="card-img-top story-img" alt="Broken Horizon">
          <div class="card-body">
            <h6 class="card-title">Broken Horizon</h6>
            <small class="text-muted">by Kenji Tanaka</small>
            <div class="mt-2">
              <span class="badge bg-danger">Action</span>
            </div>
            <div class="story-stats">
              <span class="reads">Ch. 10 of 15</span>
              <span class="rating">4.7 ★</span>
            </div>
            <div class="progress mt-2" style="height: 4px;">
              <div class="progress-bar" style="width: 67%"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6">
        <div class="card h-100 story-card">
          <img src="https://images.unsplash.com/photo-1457365050282-c53d772ef8b2?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" class="card-img-top story-img" alt="Across the Void">
          <div class="card-body">
            <h6 class="card-title">Across the Void</h6>
            <small class="text-muted">by Aiden Walker</small>
            <div class="mt-2">
              <span class="badge bg-dark">Sci-Fi</span>
            </div>
            <div class="story-stats">
              <span class="reads">Ch. 2 of 9</span>
              <span class="rating">4.6 ★</span>
            </div>
            <div class="progress mt-2" style="height: 4px;">
              <div class="progress-bar" style="width: 22%"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Trending Now -->
    <h4 class="section-title"><i class="fas fa-fire"></i>Trending Now</h4>
    <div class="row g-3">
      <!-- Trending stories will be populated similarly -->
      <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6">
        <div class="card h-100 story-card">
          <img src="https://images.unsplash.com/photo-1534447677768-be436bb09401?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" class="card-img-top story-img" alt="Dragon's Fire">
          <div class="card-body">
            <h6 class="card-title">Dragon's Fire</h6>
            <small class="text-muted">by Ryan O'Connell</small>
            <div class="mt-2">
              <span class="badge bg-primary">Fantasy</span>
            </div>
            <div class="story-stats">
              <span class="reads">8.7k reads</span>
              <span class="rating">4.8 ★</span>
            </div>
          </div>
        </div>
      </div>

      <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6">
        <div class="card h-100 story-card">
          <img src="https://images.unsplash.com/photo-1512820790803-83ca734da794?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" class="card-img-top story-img" alt="Shadow Games">
          <div class="card-body">
            <h6 class="card-title">Shadow Games</h6>
            <small class="text-muted">by Isabella Rossi</small>
            <div class="mt-2">
              <span class="badge bg-success">Thriller</span>
            </div>
            <div class="story-stats">
              <span class="reads">7.2k reads</span>
              <span class="rating">4.7 ★</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Additional trending stories would go here -->
    </div>

  </div>

<!-- Footer -->
<footer class="bg-dark text-white py-4">
  <div class="container-fluid">
    <div class="row">
      <div class="col-md-6">
        <a class="navbar-brand text-white mb-3 d-inline-block" href="index.html">
          <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="currentColor" class="bi bi-book me-2"
            viewBox="0 0 16 16">
            <path
              d="M1 2.828c.885-.37 2.154-.769 3.388-.893 1.33-.134 2.458.063 3.112.752v9.746c-.935-.53-2.12-.603-3.213-.493-1.18.12-2.37.461-3.287.811V2.828zm7.5-.141c.654-.689 1.782-.886 3.112-.752 1.234.124 2.503.523 3.388.893v9.923c-.918-.35-2.107-.692-3.287-.81-1.094-.111-2.278-.039-3.213.492V2.687zM8 1.783C7.015.936 5.587.81 4.287.94c-1.514.153-3.042.672-3.994 1.105A.5.5 0 0 0 0 2.5v11a.5.5 0 0 0 .707.455c.882-.4 2.303-.881 3.68-1.02 1.409-.142 2.59.087 3.223.877a.5.5 0 0 0 .78 0c.633-.79 1.814-1.019 3.222-.877 1.378.139 2.8.62 3.681 1.02A.5.5 0 0 0 16 13.5v-11a.5.5 0 0 0-.293-.455c-.952-.433-2.48-.952-3.994-1.105C10.413.809 8.985.936 8 1.783z" />
          </svg>
          Storyline
        </a>
        <p class="text-white-50">
          Where stories come alive. Discover new tales, write your own, and connect with readers everywhere.
        </p>
      </div>
      <div class="col-md-6 text-md-end">
        <p class="text-white-50 mb-1">&copy; 2025 Storyline. All rights reserved.</p>
        <p class="mb-0">Made with <i class="fas fa-heart text-danger"></i> for storytellers</p>
      </div>
    </div>
  </div>
</footer>




  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const currentUser = JSON.parse(localStorage.getItem("currentUser"));

      // Update welcome message with user's name if available
      const welcomeMessage = document.getElementById("welcomeMessage");
      if (currentUser && currentUser.name) {
        welcomeMessage.textContent = `Welcome back, ${currentUser.name.split(' ')[0]}!`;
        document.getElementById("userInitial").textContent = currentUser.name.charAt(0).toUpperCase();
      }

      // Genre filter functionality
      document.querySelectorAll('.genre-tag').forEach(tag => {
        tag.addEventListener('click', function() {
          this.classList.toggle('active');
          // In a real app, this would filter the stories
          console.log(`Filtering by genre: ${this.dataset.genre}`);
        });
      });

      // Search functionality
      const searchInput = document.getElementById('searchInput');
      if (searchInput) {
        searchInput.addEventListener('input', function() {
          // In a real app, this would search through stories
          console.log(`Searching for: ${this.value}`);
        });
      }

      // The rest of your existing JavaScript for My Stories section
      const loginLink = document.querySelector('a[href="login.html"]')?.closest("li");
      const signupLink = document.querySelector('a[href="register.html"]')?.closest("li");
      const profileDropdown = document.querySelector(".nav-item.dropdown");

      const myStoriesSection = document.querySelector('h4.section-title'); // first h4 is My Stories
      const dashboardMyStories = document.getElementById('dashboardMyStories');
      
  const noDashboardStories = document.getElementById('noDashboardStories');

  if (currentUser) {
    // User is logged in → hide login/signup, show profile
    if (loginLink) loginLink.style.display = "none";
    if (signupLink) signupLink.style.display = "none";
    if (profileDropdown) profileDropdown.style.display = "block";

    // Show My Stories
    myStoriesSection.style.display = "block";
    dashboardMyStories.style.display = "flex";
    noDashboardStories.style.display = "block";

    renderDashboardMyStories();

  } else {
    // No logged-in user → show login/signup, hide profile
    if (loginLink) loginLink.style.display = "block";
    if (signupLink) signupLink.style.display = "block";
    if (profileDropdown) profileDropdown.style.display = "none";

    // Hide My Stories section
    myStoriesSection.style.display = "none";
    dashboardMyStories.style.display = "none";
    noDashboardStories.style.display = "none";
  }

  const logoutBtn = document.getElementById("logoutBtn");
  if (logoutBtn) {
    logoutBtn.addEventListener("click", function (e) {
      e.preventDefault();
      localStorage.removeItem("currentUser"); // clear the logged-in user
      window.location.href = "index.html";   // redirect after logout
    });
  }

  function getUserStories() {
    return JSON.parse(localStorage.getItem('userStories')) || [];
  }

  function getGenreColor(genre) {
    const colors = {
      'Fantasy': 'bg-primary',
      'Thriller': 'bg-success',
      'Horror': 'bg-warning text-dark',
      'Mystery': 'bg-info text-dark',
      'Action': 'bg-danger',
      'Sci-Fi': 'bg-dark',
      'Romance': 'bg-danger',
      'Comedy': 'bg-secondary',
      'Drama': 'bg-light text-dark',
      'Adventure': 'bg-success',
      'Historical': 'bg-info text-dark'
    };
    return colors[genre] || 'bg-primary';
  }

  function renderDashboardMyStories() {
    const container = document.getElementById('dashboardMyStories');
    const noStories = document.getElementById('noDashboardStories');
    const userStories = getUserStories();

    container.innerHTML = '';

    if (userStories.length === 0) {
      noStories.classList.remove('d-none');
      return;
    }

    noStories.classList.add('d-none');

    // Limit to first 6 stories for dashboard
    userStories.slice(0, 6).forEach((story, index) => {
      const col = document.createElement('div');
      col.classList.add('col-xl-2', 'col-lg-3', 'col-md-4', 'col-sm-6', 'col-6');

      col.innerHTML = `
        <div class="card h-100 story-card" style="cursor:pointer;">
          <img src="${story.cover}" class="card-img-top story-img" alt="${story.title}">
          <div class="card-body d-flex flex-column justify-content-between">
            <div>
              <h6 class="card-title mb-1">${story.title}</h6>
              <small class="text-muted">by ${story.author}</small>
            </div>
            <div class="mt-2">
              ${Array.isArray(story.genre) ? story.genre.map(g => `<span class="badge me-1 ${getGenreColor(g)}">${g}</span>`).join('') : `<span class="badge bg-primary">${story.genre}</span>`}
            </div>
          </div>
        </div>
      `;

      // Add click listener to go to stories.html
      col.querySelector(".story-card").addEventListener("click", () => {
        const globalIndex = getUserStories().indexOf(story); // index in full userStories array
        localStorage.setItem("viewStoryIndex", globalIndex);
        window.location.href = "stories.html";
      });

      container.appendChild(col);
    });
  }
});
</script>

</body>

</html>