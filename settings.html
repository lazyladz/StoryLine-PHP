<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Settings - StoryLine</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body {
      background-color: #f8f9fb;
    }
    .sidebar {
      min-height: 100vh;
      background-color: #0d1321;
      color: #fff;
    }
    .sidebar a {
      color: #adb5bd;
      text-decoration: none;
      display: block;
      padding: .75rem 1rem;
      border-radius: .375rem;
      transition: all 0.3s ease;
    }
    .sidebar a:hover, .sidebar a.active {
      background-color: #1c2333;
      color: #fff;
    }
    .settings-section {
      background: white;
      padding: 1.5rem;
      border-radius: .75rem;
      margin-bottom: 1.5rem;
      box-shadow: 0 2px 8px rgba(0,0,0,.08);
    }
    .settings-section h5 {
      color: #0d1321;
      margin-bottom: 1.5rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid #e9ecef;
    }
    .form-label {
      font-weight: 500;
      color: #495057;
    }
  </style>
</head>
<body>
<div class="container-fluid">
  <div class="row">
    <!-- Sidebar -->
    <nav class="col-md-3 col-lg-2 d-md-block sidebar p-3">
      <h4 class="text-white mb-4">StoryLine</h4>
      <ul class="nav flex-column mt-4">
        <li class="nav-item"><a href="index.html" class="nav-link"><i class="fas fa-chart-bar me-2"></i>Dashboard</a></li>
        <li class="nav-item"><a href="manageUser.html" class="nav-link"><i class="fas fa-users me-2"></i>Manage Users</a></li>
        <li class="nav-item"><a href="manageStories.html" class="nav-link"><i class="fas fa-book me-2"></i>Manage Stories</a></li>
        <li class="nav-item"><a href="notifications.html" class="nav-link"><i class="fas fa-bell me-2"></i>Notifications</a></li>
        <li class="nav-item"><a href="settings.html" class="nav-link active text-white"><i class="fas fa-cog me-2"></i>Settings</a></li>
        <li class="nav-item"><a href="#" class="nav-link" id="logoutLink"><i class="fas fa-sign-out-alt me-2"></i>Log Out</a></li>
      </ul>
      <div class="mt-auto pt-3">
        <button type="button" class="btn btn-outline-light w-100" data-bs-toggle="modal" data-bs-target="#userProfileModal">
          <strong id="sidebarUserName">Loading...</strong><br>
          <small id="sidebarUserEmail">Loading...</small>
        </button>
      </div>
    </nav>

    <!-- User Profile Modal -->
    <div class="modal fade" id="userProfileModal" tabindex="-1" aria-labelledby="userProfileLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="userProfileLabel">User Profile</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body text-center">
            <img src="https://via.placeholder.com/100" class="rounded-circle mb-3" alt="Profile Picture" id="profilePicture">
            <h5 id="modalUserName">Loading...</h5>
            <p class="text-muted" id="modalUserEmail">Loading...</p>
            <hr>
            <p><strong>Role:</strong> <span id="modalUserRole" class="fw-bold text-primary">Administrator</span></p>
            <p><strong>Joined:</strong> <span id="modalUserJoined">Loading...</span></p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary" id="editProfileBtn">Edit Profile</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Edit Profile Modal -->
    <div class="modal fade" id="editProfileModal" tabindex="-1" aria-labelledby="editProfileLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="editProfileLabel"><i class="fas fa-user-edit me-2"></i>Edit Profile</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="text-center mb-3">
              <img src="https://via.placeholder.com/100" class="rounded-circle mb-2" alt="Profile Picture" id="editProfilePicture">
              <br>
              <button type="button" class="btn btn-outline-secondary btn-sm" onclick="changeProfilePicture()"><i class="fas fa-camera me-1"></i>Change Picture</button>
            </div>
            <div class="mb-3">
              <label class="form-label"><i class="fas fa-user me-1"></i>Username</label>
              <input type="text" class="form-control" id="editUsername" placeholder="Enter username">
            </div>
            <div class="mb-3">
              <label class="form-label"><i class="fas fa-envelope me-1"></i>Email</label>
              <input type="email" class="form-control" id="editEmail" placeholder="Enter email">
            </div>
            <div class="mb-3">
              <label class="form-label"><i class="fas fa-info-circle me-1"></i>Bio</label>
              <textarea class="form-control" id="editBio" rows="3" placeholder="Tell us about yourself..."></textarea>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-primary" onclick="saveProfileChanges()"><i class="fas fa-save me-1"></i>Save Changes</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 py-4">
      <h2 class="mb-4"><i class="fas fa-cog me-2"></i>Settings</h2>
      
      <div class="settings-section">
        <h5><i class="fas fa-user-cog me-2"></i>Account Settings</h5>
        <div class="mb-3">
          <label class="form-label"><i class="fas fa-bell me-1"></i>Email Notifications</label>
          <select class="form-select" id="emailNotifications">
            <option value="all">All notifications</option>
            <option value="important">Important only</option>
            <option value="none">None</option>
          </select>
        </div>
        <div class="form-check mb-3">
          <input class="form-check-input" type="checkbox" id="newsletter">
          <label class="form-check-label" for="newsletter">
            <i class="fas fa-newspaper me-1"></i>Receive newsletter
          </label>
        </div>
        <div class="form-check mb-3">
          <input class="form-check-input" type="checkbox" id="securityAlerts" checked>
          <label class="form-check-label" for="securityAlerts">
            <i class="fas fa-shield-alt me-1"></i>Security alerts
          </label>
        </div>
      </div>

      <div class="settings-section">
        <h5><i class="fas fa-lock me-2"></i>Privacy Settings</h5>
        <div class="form-check mb-3">
          <input class="form-check-input" type="checkbox" id="profileVisibility" checked>
          <label class="form-check-label" for="profileVisibility">
            <i class="fas fa-eye me-1"></i>Make profile public
          </label>
        </div>
        <div class="form-check mb-3">
          <input class="form-check-input" type="checkbox" id="activityStatus" checked>
          <label class="form-check-label" for="activityStatus">
            <i class="fas fa-circle me-1"></i>Show online status
          </label>
        </div>
        <div class="form-check mb-3">
          <input class="form-check-input" type="checkbox" id="searchVisibility" checked>
          <label class="form-check-label" for="searchVisibility">
            <i class="fas fa-search me-1"></i>Allow search engines to index my profile
          </label>
        </div>
      </div>

      <div class="settings-section">
        <h5><i class="fas fa-palette me-2"></i>Appearance</h5>
        <div class="mb-3">
          <label class="form-label"><i class="fas fa-moon me-1"></i>Theme</label>
          <select class="form-select" id="themeSelect">
            <option value="light">Light</option>
            <option value="dark">Dark</option>
            <option value="auto">Auto (System)</option>
          </select>
        </div>
        <div class="mb-3">
          <label class="form-label"><i class="fas fa-font me-1"></i>Font Size</label>
          <select class="form-select" id="fontSize">
            <option value="small">Small</option>
            <option value="medium" selected>Medium</option>
            <option value="large">Large</option>
          </select>
        </div>
      </div>

      <div class="settings-section">
        <h5><i class="fas fa-language me-2"></i>Language & Region</h5>
        <div class="mb-3">
          <label class="form-label"><i class="fas fa-globe me-1"></i>Language</label>
          <select class="form-select" id="languageSelect">
            <option value="en" selected>English</option>
            <option value="es">Spanish</option>
            <option value="fr">French</option>
            <option value="de">German</option>
          </select>
        </div>
        <div class="mb-3">
          <label class="form-label"><i class="fas fa-flag me-1"></i>Time Zone</label>
          <select class="form-select" id="timezoneSelect">
            <option value="est">Eastern Time (ET)</option>
            <option value="cst">Central Time (CT)</option>
            <option value="mst">Mountain Time (MT)</option>
            <option value="pst" selected>Pacific Time (PT)</option>
          </select>
        </div>
      </div>

      <div class="d-flex gap-2">
        <button class="btn btn-primary" onclick="saveSettings()">
          <i class="fas fa-save me-1"></i>Save Settings
        </button>
        <button class="btn btn-outline-secondary" onclick="resetSettings()">
          <i class="fas fa-undo me-1"></i>Reset to Default
        </button>
      </div>
    </main>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const currentUser = JSON.parse(localStorage.getItem('currentUser'));
    if (!currentUser) {
      window.location.href = 'login.html';
      return;
    }
    
    // Update sidebar user info
    document.getElementById('sidebarUserName').textContent = currentUser.username || currentUser.name;
    document.getElementById('sidebarUserEmail').textContent = currentUser.email;
    
    // Update modal user info
    document.getElementById('modalUserName').textContent = currentUser.username || currentUser.name;
    document.getElementById('modalUserEmail').textContent = currentUser.email;
    document.getElementById('modalUserRole').textContent = "Administrator";
    document.getElementById('modalUserJoined').textContent = currentUser.joined || "January 2023";
    
    // Populate edit form
    document.getElementById('editUsername').value = currentUser.username || currentUser.name;
    document.getElementById('editEmail').value = currentUser.email;
    document.getElementById('editBio').value = currentUser.bio || "No bio yet...";
    
    // Edit profile button
    document.getElementById('editProfileBtn').addEventListener('click', function() {
      bootstrap.Modal.getInstance(document.getElementById('userProfileModal')).hide();
      new bootstrap.Modal(document.getElementById('editProfileModal')).show();
    });
    
    // Logout
    document.getElementById('logoutLink').addEventListener('click', function(e) {
      e.preventDefault();
      if (confirm('Are you sure you want to log out?')) {
        localStorage.removeItem('currentUser');
        alert('You have been logged out successfully.');
        window.location.href = 'login.html';
      }
    });

    // Load saved settings
    loadSettings();
  });

  function changeProfilePicture() {
    alert('Change Profile Picture\n\nThis would open a file picker to upload a new profile picture.');
  }

  function saveProfileChanges() {
    const newUsername = document.getElementById('editUsername').value;
    const newEmail = document.getElementById('editEmail').value;
    const newBio = document.getElementById('editBio').value;
    
    if (!newUsername || !newEmail) {
      alert('Please fill in all required fields.');
      return;
    }
    
    const currentUser = JSON.parse(localStorage.getItem('currentUser'));
    currentUser.username = newUsername;
    currentUser.name = newUsername;
    currentUser.email = newEmail;
    currentUser.bio = newBio;
    
    localStorage.setItem('currentUser', JSON.stringify(currentUser));
    
    document.getElementById('sidebarUserName').textContent = newUsername;
    document.getElementById('modalUserName').textContent = newUsername;
    document.getElementById('modalUserEmail').textContent = newEmail;
    document.getElementById('sidebarUserEmail').textContent = newEmail;
    
    alert('Profile updated successfully!');
    bootstrap.Modal.getInstance(document.getElementById('editProfileModal')).hide();
  }

  function saveSettings() {
    const settings = {
      emailNotifications: document.getElementById('emailNotifications').value,
      newsletter: document.getElementById('newsletter').checked,
      securityAlerts: document.getElementById('securityAlerts').checked,
      profileVisibility: document.getElementById('profileVisibility').checked,
      activityStatus: document.getElementById('activityStatus').checked,
      searchVisibility: document.getElementById('searchVisibility').checked,
      theme: document.getElementById('themeSelect').value,
      fontSize: document.getElementById('fontSize').value,
      language: document.getElementById('languageSelect').value,
      timezone: document.getElementById('timezoneSelect').value
    };
    
    localStorage.setItem('userSettings', JSON.stringify(settings));
    alert('Settings saved successfully!');
  }

  function loadSettings() {
    const savedSettings = localStorage.getItem('userSettings');
    if (savedSettings) {
      const settings = JSON.parse(savedSettings);
      
      document.getElementById('emailNotifications').value = settings.emailNotifications || 'all';
      document.getElementById('newsletter').checked = settings.newsletter || false;
      document.getElementById('securityAlerts').checked = settings.securityAlerts !== false;
      document.getElementById('profileVisibility').checked = settings.profileVisibility !== false;
      document.getElementById('activityStatus').checked = settings.activityStatus !== false;
      document.getElementById('searchVisibility').checked = settings.searchVisibility !== false;
      document.getElementById('themeSelect').value = settings.theme || 'light';
      document.getElementById('fontSize').value = settings.fontSize || 'medium';
      document.getElementById('languageSelect').value = settings.language || 'en';
      document.getElementById('timezoneSelect').value = settings.timezone || 'pst';
    }
  }

  function resetSettings() {
    if (confirm('Are you sure you want to reset all settings to default?')) {
      localStorage.removeItem('userSettings');
      location.reload();
    }
  }
</script>
</body>
</html>